<!DOCTYPE html>  <html lang="en">  
<head>  
<meta charset="UTF-8">  
<title>Patient Dashboard | Emergency Assist+</title>  <!-- FIREBASE SDK -->  
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script> 
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script> 
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script> 
  <style>  
  
body{font-family:Arial;background:#f4f6f9;margin:0}  
.dashboard{max-width:420px;margin:auto;padding:15px;position:relative}  
  
/* HEADER */  
.header{display:flex;justify-content:space-between;align-items:center}  
.profile{display:flex;gap:10px;align-items:center}  
.profile img{width:50px;height:50px;border-radius:50%;object-fit:cover;border:2px solid #007bff;cursor:pointer}  
.menu-btn{font-size:26px;cursor:pointer}  
  
/* MENU */  
.menu{  
position:absolute;top:60px;right:15px;background:#fff;  
width:200px;border-radius:10px;display:none;  
box-shadow:0 8px 20px rgba(0,0,0,.2);z-index:10  
}  
.menu a{display:block;padding:12px;text-decoration:none;color:#333}  
.menu a:hover{background:#f1f1f1}  
.menu hr{border:none;border-top:1px solid #eee}  
  
/* MAP */  
.map iframe{width:100%;height:220px;border-radius:12px;border:none}  
  
/* VITALS */  
.row{display:flex;gap:10px;margin-top:10px}  
.vital{flex:1;background:#fff;padding:12px;border-radius:12px;text-align:center}  
.sos-box{display:flex;flex-direction:column;align-items:center;gap:6px}  
.sos{width:70px;height:70px;border-radius:50%;background:red;color:#fff;border:none;font-size:20px}  
.mic{width:45px;height:45px;border-radius:50%;border:none}  
  
/* CHATBOT */  
.chatbot{background:#fff;margin-top:15px;padding:10px;border-radius:12px}  
.chat-box{max-height:150px;overflow:auto;font-size:13px}  
.bot{color:#007bff}  
.user{text-align:right}  
  
/* MODAL */  
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:999}  
.modal-content{  
background:#fff;margin:8% auto;padding:20px;  
width:90%;max-width:400px;border-radius:12px  
}  
.modal-content input,  
.modal-content textarea,  
.modal-content select{  
width:100%;padding:8px;margin:5px 0  
}  
button{padding:10px;width:100%;border:none;border-radius:8px}  
.save{background:#007bff;color:#fff}  
.close{background:#ccc;margin-top:8px}  
  
.status{color:green;font-size:13px}  
.not{color:red;font-size:13px}  
</style> 
</head>  
<body>  
  <div class="dashboard"> 
    <!-- HEADER -->  
    <div class="header">  
  <div class="profile">  
    <img id="profilePic" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" onclick="openProfile()">  
    <div>  
      <b id="username">Patient</b>
      <br>  
      <small class="status">‚óè Online</small>  
    </div>  
  </div>  
  <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>  
</div> 
    <!-- MENU -->
    <div class="menu" id="menu">  
  <a onclick="openProfile()">üë§ Profile</a>  
  <a onclick="openDetails()">üßæ My Details</a>  
  <a onclick="openSettings()">‚öôÔ∏è Settings</a>  
  <hr>  
  <a onclick="logout()">üîì Logout</a>  
</div>  <div class="map" id="mapBox">  
  <iframe  
    id="mapFrame"  
    src="https://maps.google.com/maps?q=14.5995,120.9842&z=15&output=embed">  
  </iframe> 
  <button onclick="openHospitals()" style="  
margin-top:6px;  
background:#28a745;  
color:#fff;  
border:none;  
border-radius:8px;  
padding:8px;  
width:100%;  
">
üè• Nearby Hospitals
</button>

</div>
    <!-- HEART RATE + SOS -->  
    <div class="row">  
  <div class="vital">  
    <p>‚ù§Ô∏è Heart Rate</p>  
    <h2 id="heartRate">--</h2>  
    <small id="hrStatus"></small>  
  </div>    <div class="sos-box">  
    <button class="sos" id="sosBtn">SOS</button>  
    <button class="mic" id="micBtn">üé§</button>  
    <small id="voiceStatus">Tap mic</small>  
  </div>  
</div>
    <!-- CHATBOT --> 
    <div class="chatbot">  
<h4>ü§ñ AI First Aid Assistant</h4>  
<div id="chatBox" class="chat-box">  
<p class="bot">Sabihin mo ang nararamdaman mo.<br>
  <small>‚ö†Ô∏è Hindi ito kapalit ng doktor</small></p>  
</div>  
<input id="userInput" placeholder="Hal. Nahihilo ako">  
<button onclick="sendToAI()">Send</button>  
<button onclick="speakLast()">üîä Speak</button>  
</div>  </div>  <!-- PROFILE MODAL -->  <div class="modal" id="profileModal">  
<div class="modal-content">  
<h3>Upload Profile Image</h3>  
<input type="file" id="uploadPic">  
<button class="save" onclick="uploadImage()">Upload</button>  
<button class="close" onclick="closeAll()">Close</button>  
</div>  
</div> 
  <!-- DETAILS MODAL --> 
  <div class="modal" id="detailsModal">  
<div class="modal-content">  
<h3>Patient Medical Record</h3>  
<input id="fullName" placeholder="Full Name">  
<input id="age" placeholder="Age">  
<select id="gender"><option>Male</option><option>Female</option></select>  
<textarea id="allergies" placeholder="Allergies"></textarea>  
<textarea id="illness" placeholder="Illness"></textarea>  
<input id="emergencyName" placeholder="Emergency Contact Name">  
<input id="emergencyNumber" placeholder="Emergency Contact Number">  
<button class="save" onclick="saveDetails()">Save</button>  
<button class="close" onclick="closeAll()">Close</button>  
</div>  
</div>
  <!-- SETTINGS MODAL --> 
  <div class="modal" id="settingsModal">  
<div class="modal-content">  
<h3>Settings</h3>  
<select id="deviceSelect" onchange="updateDevice()">  
<option value="">Select Device</option>  
<option>Watch</option>  
<option>Phone</option>  
<option>Laptop</option>  
</select>  
<p id="deviceStatus" class="not">Not Connected</p>  
<label><input type="checkbox" id="mapToggle" checked onchange="toggleMap()"> Show Map</label>  
<button class="close" onclick="closeAll()">Close</button>  
</div>  
</div>  <script>  
/* FIREBASE CONFIG */  
firebase.initializeApp({  
  apiKey:"AIzaSyALmKTZrmeL3RC6M5DUEZVbYHTscMlk2Bo",  
  authDomain:"mobileapps-c644c.firebaseapp.com",  
  projectId:"mobileapps-c644c",  
  storageBucket:"mobileapps-c644c.appspot.com"  
});  
const db=firebase.firestore();  
  /* üü¶ MENU & MODAL ELEMENTS */  
const menu = document.getElementById("menu");  
const profileModal = document.getElementById("profileModal");  
const detailsModal = document.getElementById("detailsModal");  
const settingsModal = document.getElementById("settingsModal");  
const mapBox = document.getElementById("mapBox");  
  
let currentUser,heartRateValue=70,sosHold;  
  
/* AUTH */  
firebase.auth().onAuthStateChanged(u=>{  
if(!u)location.href="index.html";  
currentUser=u;  
});  
  
/* MENU */  
function toggleMenu(){menu.style.display=menu.style.display==="block"?"none":"block"}  
function openProfile(){closeAll();profileModal.style.display="block"}  
function openDetails(){closeAll();detailsModal.style.display="block"}  
function openSettings(){closeAll();settingsModal.style.display="block"}  
function closeAll(){  
menu.style.display=  
profileModal.style.display=  
detailsModal.style.display=  
settingsModal.style.display="none"  
}  
  
/* MAP */
function updateLiveLocation(){
navigator.geolocation.getCurrentPosition(p=>{
mapFrame.src=`https://maps.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}&z=15&output=embed`;
});
}
  setInterval(updateLiveLocation,10000);
updateLiveLocation();
function openHospitals(){
navigator.geolocation.getCurrentPosition(p=>{
mapFrame.src=`https://maps.google.com/maps?q=hospital+near+${p.coords.latitude},${p.coords.longitude}&z=15&output=embed`;
});
}
function toggleMap(){mapBox.style.display=mapToggle.checked?"block":"none"}

/* HEART RATE */  
if (heartRateValue < 55 || heartRateValue > 120) {
  hrStatus.innerText = "Not Normal";
  hrStatus.style.color = "red";

  sendSOS(true); // auto emergency
} else {
  hrStatus.innerText = "Normal";
  hrStatus.style.color = "green";
}
  
/* SOS */  
sosBtn.onmousedown=()=>sosHold=setTimeout(()=>sendSOS(false),2000);  
sosBtn.onmouseup=()=>clearTimeout(sosHold);  
sosBtn.ontouchstart=()=>sosHold=setTimeout(()=>sendSOS(false),2000);  
sosBtn.ontouchend=()=>clearTimeout(sosHold);  
  
function sendSOS(auto){
triggerWatchEmergency();  
  
navigator.geolocation.getCurrentPosition(p=>{  
db.collection("emergencies").add({  
uid:currentUser.uid,  
lat:p.coords.latitude,  
lng:p.coords.longitude,  
heartRate:heartRateValue,  
auto,time:new Date()  
});  
alert("üö® SOS SENT");  
});  
}  
  
/* üü¶ AI FIRST AID CHATBOT ‚Äì PROFESSIONAL */
let lastReply="";
  /* üö® WATCH EMERGENCY ALERT */
function triggerWatchEmergency(){
  const alarm = document.getElementById("emergencySound");

  // Play alarm
  alarm.currentTime = 0;
  alarm.play().catch(()=>{});

  // VIBRATION (WATCH / PHONE)
  if (navigator.vibrate) {
    navigator.vibrate([500,300,500,300,500,300]);
  }

  alert("üö® WATCH EMERGENCY ACTIVATED");
}
  /* üö® DANGEROUS SYMPTOMS FOR AUTO SOS */
const dangerKeywords = [
  "sakit ng dibdib",
  "hirap huminga",
  "di makahinga",
  "nawawalan ng malay",
  "nahimatay",
  "seizure",
  "kombulsyon",
  "malakas na pagdurugo",
  "stroke",
  "heart attack"
];

function sendToAI(){
  const msg = userInput.value.toLowerCase();
  if(!msg) return;

  chatBox.innerHTML += `<p class="user">${userInput.value}</p>`;

  let reply = "";
  let warning = 
  "‚ö†Ô∏è PAALALA: Ang impormasyong ito ay hindi kapalit ng doktor. " +
  "Kung lumala ang sintomas, tumawag agad sa emergency services.";

  /* SYMPTOM MATCHING */
  if(msg.includes("nahihilo") || msg.includes("dizzy")){
    reply =
    "ü©∫ Mukhang ikaw ay nahihilo. Umupo o humiga agad, uminom ng tubig, " +
    "at iwasan ang biglang pagtayo.";
  }
  else if(msg.includes("sakit ng dibdib") || msg.includes("chest pain")){
    reply =
    "üö® Ang sakit sa dibdib ay maaaring seryoso. Huminto sa anumang ginagawa " +
    "at humingi agad ng tulong medikal.";
  }
  else if(msg.includes("hirap huminga") || msg.includes("breathing")){
    reply =
    "üö® Ang hirap sa paghinga ay delikado. Umupo ng tuwid at tumawag agad ng emergency.";
  }
  else if(msg.includes("lagnat") || msg.includes("fever")){
    reply =
    "üå°Ô∏è May lagnat ka. Uminom ng maraming tubig, magpahinga, at bantayan ang temperatura.";
  }
  else if(msg.includes("sugat") || msg.includes("dumudugo")){
    reply =
    "ü©π Kung may sugat at dumudugo, pindutin ng malinis na tela at itaas ang sugatang bahagi.";
  }
  else if(msg.includes("ubo") || msg.includes("sipon")){
    reply =
    "ü§ß Uminom ng mainit na tubig, magpahinga, at iwasan ang malamig na inumin.";
  }
  else{
    reply =
    "ü©∫ Naiintindihan ko ang iyong nararamdaman. Subukang magpahinga at obserbahan ang sintomas.";
  }

  lastReply = reply + "<br><br><small>" + warning + "</small>";
  /* üö® AUTO SOS TRIGGER */
dangerKeywords.forEach(word=>{
  if(msg.includes(word)){
    sendSOS(true);
  }
});

  chatBox.innerHTML += `<p class="bot">${lastReply}</p>`;
  chatBox.scrollTop = chatBox.scrollHeight;

  /* AUTO VOICE WARNING */
  speakLast();

  userInput.value = "";
}

/* TEXT TO SPEECH */
function speakLast(){
  const cleanText = lastReply.replace(/<[^>]*>/g, "");

  const warningVoice =
  "Paalala. Ang impormasyong ito ay hindi kapalit ng doktor. " +
  "Kung lumalala ang iyong nararamdaman, tumawag agad ng emergency.";

  const speech = new SpeechSynthesisUtterance(
    cleanText + ". " + warningVoice
  );

  speech.lang = "fil-PH"; // TAGALOG
  speech.rate = 0.9;
  speech.pitch = 1;
  speechSynthesis.speak(speech);
}

/* SETTINGS */  
function updateDevice(){  
deviceStatus.innerText=deviceSelect.value?"Connected ("+deviceSelect.value+")":"Not Connected";  
deviceStatus.className=deviceSelect.value?"status":"not";  
}  
function toggleMap(){mapBox.style.display=mapToggle.checked?"block":"none"}  
  
/* PROFILE UPLOAD */  
function uploadImage(){  
const f=uploadPic.files[0];  
firebase.storage().ref("profiles/"+currentUser.uid).put(f).then(r=>{  
r.ref.getDownloadURL().then(u=>{  
profilePic.src=u;  
});  
});  
}  
  
/* SAVE DETAILS */  
function saveDetails(){  
db.collection("patient_details").doc(currentUser.uid).set({  
fullName:fullName.value,age:age.value,gender:gender.value,  
allergies:allergies.value,illness:illness.value,  
emergencyName:emergencyName.value,emergencyNumber:emergencyNumber.value  
});  
alert("Saved");  
closeAll();  
}  
  
/* LOGOUT */  
function logout(){firebase.auth().signOut().then(()=>location.href="index.html")}  
    
  function updateLiveLocation(){  
  if(!navigator.geolocation) return;  
  
  navigator.geolocation.getCurrentPosition(  
    p=>{  
      const lat = p.coords.latitude;  
      const lng = p.coords.longitude;  
      mapFrame.src =  
        `https://maps.google.com/maps?q=${lat},${lng}&z=16&output=embed`;  
    },  
    e=>{  
      console.log("Location denied");  
    }  
  );  
}  
  
/* update every 10 seconds */  
setInterval(updateLiveLocation,10000);  
  
/* first load */  
updateLiveLocation();  
    
  function openHospitals(){  
  if(!navigator.geolocation){  
    alert("Location not supported");  
    return;  
  }  
  
/* MAP ‚Äì SAFE + WORKING */  
if (navigator.geolocation) {  
  navigator.geolocation.getCurrentPosition(  
    p => {  
      const lat = p.coords.latitude;  
      const lng = p.coords.longitude;  
      mapFrame.src =  
        `https://maps.google.com/maps?q=${lat},${lng}&z=15&output=embed`;  
    },  
    e => {  
      console.log("Location denied, using default map");  
    }  
  );  
}  
}  
</script>
<audio id="emergencySound" loop>
  <source src="https://actions.google.com/sounds/v1/alarms/emergency_siren.ogg" type="audio/ogg">
</audio>  
</body>  
</html>